"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[6678],{95412:(e,r,t)=>{t.d(r,{S:()=>p});var n=t(7527),a=t(75087),o=t(22155),s=t(30395),c=t.n(s),i=t(36780),l=t(52788),u=["name","checked","children","className","checkmarkClassName","onToggleCallback","id","disabled","defaultChecked"],d=o.createElement,p=(0,o.forwardRef)((function(e,r){var t=e.name,s=e.checked,p=e.children,v=e.className,b=e.checkmarkClassName,f=e.onToggleCallback,k=e.id,m=void 0===k?"":k,h=e.disabled,y=e.defaultChecked,g=(0,a.A)(e,u),x=(0,o.useState)(null!=s?s:y),w=x[0],O=x[1],R=(0,o.useId)(),C=m.concat(R);(0,o.useEffect)((function(){O(null!=s?s:y)}),[s,y]);return d("label",{className:c()("relative z-1 inline-flex select-none items-center p-1 pr-3 text-text-tertiary typo-footnote",!h&&"cursor-pointer",l.A.label,v,{checked:w,disabled:h}),style:{transition:"color 0.1s linear"},htmlFor:C},d("input",(0,n.A)({"aria-labelledby":"label-span-".concat(R),checked:s,defaultChecked:y,className:"absolute h-0 w-0 opacity-0","data-testid":"checkbox-input",disabled:h,id:C,name:t,onChange:function(e){O(e.target.checked),null==f||f(e.target.checked)},ref:r,type:"checkbox"},g)),d("div",{"aria-checked":s,"aria-labelledby":"label-".concat(R),className:c()("relative z-1 mr-3 flex h-5 w-5 items-center justify-center rounded-6 border-2 border-border-subtlest-primary",l.A.checkmark,b),role:"checkbox"},d(i.w,{"aria-hidden":!0,className:"icon h-full w-full text-text-primary opacity-0",role:"presentation",style:{transition:"opacity 0.1s linear"}})),d("span",{className:"min-w-0 flex-1",id:"label-span-".concat(R)},p))}))},10591:(e,r,t)=>{t.r(r),t.d(r,{StreakRecoverModal:()=>J,StreakRecoverOptout:()=>G,default:()=>W});var n=t(7527),a=t(75087),o=t(22155),s=t(77955),c=t(89113),i=t(94198),l=t(67380),u=t(53823),d=t(83448),p=t(50122),v=t(89338),b=t(98093),f=t(2827),k=t.n(f),m=t(69918),h=t(5947),y=t(14243),g=t(9487),x=t(9495),w=t(42104),O=t(30530),R=t(71623),C=t(36899),A=t(68392),j=t(61663),S=t(57952),N=t(82422),P=t(80244),D=t(58466),F=t(70591),L=t(54883),E=t(37567),q=t(68390);function U(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?U(Object(t),!0).forEach((function(r){(0,p.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var B=function(e){var r,t,n,a,s,c,i,l,u,d=e.onAfterClose,p=e.onRequestClose,f=(0,x.d)(),U=f.isActionsFetched,B=f.completeAction,T=f.checkHasCompleted,K=(n=!1,a=(0,o.useState)(n),s=a[0],c=a[1],[s,function(e){c("boolean"!=typeof e?function(e){return!e}:e)}]),_=(0,b.A)(K,2),z=_[0],I=_[1],$=(0,A.mu)().displayToast,M=(0,j.DX)().logEvent,V=(0,N.g0)().updateAlerts,X=(0,P.Z2)(),H=X.user,Q=X.updateUser,Y=(0,D.G)().isStreaksEnabled,G=(0,m.jE)(),J=(0,g.useRouter)(),W=J.query.streak_restore,ee=(0,h.n)({mutationKey:(0,O.$h)(O.jZ.UserStreakRecover),mutationFn:(l=(0,v.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.e.request(w.qy).then((function(e){return e.recoverStreak}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),onSuccess:function(e){M({event_name:S.VB.StreakRecover}),G.invalidateQueries({queryKey:(0,O.$h)(O.jZ.UserStreak,H)}),G.invalidateQueries({queryKey:(0,O.$h)(O.jZ.Transactions,H),exact:!1}),e.balance&&Q(Z(Z({},H),{},{balance:e.balance}))},onError:(i=(0,v.A)(k().mark((function e(r){var t,n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=r.response.errors)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.extensions)||void 0===t?void 0:t.code)!==C.hD.BalanceTransactionError){e.next=5;break}if((n=r.response.errors[0]).extensions.status!==E.kr.InsufficientFunds||!n.extensions.balance){e.next=5;break}return e.next=5,Q(Z(Z({},H),{},{balance:n.extensions.balance}));case 5:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})}),re=(0,o.useCallback)((0,v.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({showRecoverStreak:!1});case 2:case"end":return e.stop()}}),e)}))),[V]),te=(0,y.I)({queryKey:(0,O.$h)(O.jZ.UserStreakRecover),queryFn:(u=(0,v.A)(k().mark((function e(){var r,t;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.e.request(w.Vg);case 2:if(null!=(t=e.sent)&&null!==(r=t.streakRecover)&&void 0!==r&&r.canRecover||!W){e.next=10;break}return e.next=7,re();case 7:$("Oops, you are no longer eligible to restore your streak"),null==p||p(),null==d||d();case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)}),enabled:!!H&&Y&&!z}),ne=te.data,ae=te.isLoading,oe=(0,o.useCallback)((0,v.A)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!z){e.next=4;break}return e.next=3,B(R.X2.DisableReadingStreakRecover);case 3:M({event_name:S.VB.DismissStreakRecover});case 4:return e.next=6,re();case 6:null==p||p(),null==d||d();case 8:case"end":return e.stop()}}),e)}))),[B,z,re,M,d,p]),se=(0,o.useCallback)((0,v.A)(k().mark((function e(){var r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(H.balance.amount<ne.streakRecover.cost)){e.next=7;break}return(r=new URLSearchParams).set("origin",S.$e.StreakRecover),q.o||r.set("next",J.pathname),null==J||J.push((0,F.Lz)("".concat(L.ZO,"cores"),r)),e.abrupt("return");case 7:return e.next=9,ee.mutateAsync();case 9:$("Lucky you! Your streak has been restored"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),$("Oops! We are unable to recover your streak. Could you try again later?");case 15:return e.next=17,null==oe?void 0:oe();case 17:case"end":return e.stop()}}),e,null,[[0,12]])}))),[null==ne||null===(r=ne.streakRecover)||void 0===r?void 0:r.cost,$,oe,ee,J,null==H||null===(t=H.balance)||void 0===t?void 0:t.amount]),ce=!U||T(R.X2.DisableReadingStreakRecover);return(0,o.useEffect)((function(){var e;null==ne||null===(e=ne.streakRecover)||void 0===e||!e.canRecover||ce||ae||M({event_name:S.VB.Impression,target_type:S.yK.StreakRecover,target_id:"restore streak"})}),[null==ne?void 0:ne.streakRecover,ce,ae,M]),{hideForever:{isChecked:z,toggle:I},onClose:oe,onRecover:se,recover:Z(Z({},null==ne?void 0:ne.streakRecover),{},{isLoading:ae,isDisabled:ce,isRecoverPending:ee.isPending})}};var T=t(95412),K=t(74689),_=t(16763),z=t(73855),I=t(96888),$=t(76800),M=["recover"],V=o.createElement,X=function(){return V("div",{className:"overflow-hidden tablet:-mx-4",role:"presentation","aria-hidden":!0},V("img",{alt:"Broken reading streak",className:"h-auto w-full object-contain",loading:"lazy",src:_.R4}))},H=function(e){var r=e.days;return V(l.o5,{className:"-mx-1 -mb-1 text-center font-bold",tag:l.UL.H3,type:l.kR.Title1,"data-testid":"streak-recover-modal-heading"},"Oh no! Your",V("span",{className:"text-accent-bacon-default"}," ",r," day streak ")," has been broken!")},Q=function(e){var r,t=e.recover,n=(0,P.Z2)().user,a=0===t.cost,s=n.balance.amount>=t.cost,c=V("a",{target:"_blank",rel:$.O8,href:L.OC,title:"What are Cores?",className:"text-text-link hover:underline"},"Cores"),i=V(o.Fragment,null,"Lucky you! The first streak restore is on us 🎁. This usually costs"," ",(0,z.rZ)(null!==(r=t.regularCost)&&void 0!==r?r:100)," ",c,". Be sure to come prepared next time!"),u=V(o.Fragment,null,"Maintain your streak!",V("br",null),"Use ",t.cost," ",c," to keep going."),d=V(o.Fragment,null,"You don't have enough ",c," to restore your streak.");return V(l.o5,{className:"text-center",tag:l.UL.P,type:l.kR.Body,"data-testid":"streak-recovery-copy"},a&&i,!a&&(s?u:d))},Y=function(e){var r=e.recover,t=(0,a.A)(e,M),o=(0,P.Z2)().user;return V(u.$n,(0,n.A)({},t,{className:"relative gap-1",variant:d.Ak.Primary,size:d.Mp.Large,"data-testid":"streak-recover-button"}),r.cost>o.balance.amount?"Buy Cores":"Restore my streak",V(I.t,null),0===r.cost?"Free":(0,z.rZ)(r.cost))},G=function(e){var r=e.hideForever,t=e.id;return V("div",{className:"flex flex-row items-center justify-center"},V(T.S,{"aria-labelledby":"showAgain-label-".concat(t),checked:r.isChecked,className:"!pr-0","data-testid":"streak-recover-optout",id:"showAgain-".concat(t),name:"showAgain",onToggleCallback:r.toggle}),V(l.o5,{"aria-label":"Never show 'reading streak recover' popup again",className:"cursor-pointer py-2.5 text-text-tertiary",htmlFor:"showAgain-".concat(t),id:"showAgain-label-".concat(t),tag:l.UL.Label,type:l.kR.Footnote},"Never show this again"))},J=function(e){var r=e.isOpen,t=e.onRequestClose,n=e.onAfterClose,a=e.user,l=(0,D.G)().isStreaksEnabled,u=(0,o.useId)(),d=B({onAfterClose:n,onRequestClose:t}),p=d.recover,v=d.hideForever,b=d.onClose,f=d.onRecover;return a&&l&&p.canRecover&&!p.isLoading&&!p.isDisabled?V(i.aF,{isOpen:r,isDrawerOnMobile:r,onRequestClose:b,size:s.rI.XSmall},V(K.O,{"aria-label":"Close streak recover popup",onClick:b,title:"Close streak recover popup"}),V(c.c,{className:"!p-4"},V("div",{className:"flex flex-col gap-4"},V(X,null),V(H,{days:p.oldStreakLength}),V(Q,{recover:p}),V(Y,{onClick:f,recover:p,loading:p.isRecoverPending}),V(G,{id:u,hideForever:v})))):null};const W=J},73855:(e,r,t)=>{t.d(r,{PK:()=>s,rZ:()=>i,vv:()=>c});var n=t(50122),a=t(81602);function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var s=function(e){return"string"==typeof e&&"true"===e.toLowerCase()},c=function(e,r){return"number"!=typeof e?"":e.toLocaleString(["en-US"],function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){(0,n.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({minimumFractionDigits:2,maximumFractionDigits:2},r))},i=function(e){return e>1e5?(0,a.Kt)(e):c(e,{minimumFractionDigits:0})}},52788:(e,r,t)=>{t.d(r,{A:()=>n});const n={checkmark:"Ur6sCRLeLJ0xiAl0Ry8kcA==",label:"_0ta8J6BOiKQx6kRDDsqEHg=="}}}]);