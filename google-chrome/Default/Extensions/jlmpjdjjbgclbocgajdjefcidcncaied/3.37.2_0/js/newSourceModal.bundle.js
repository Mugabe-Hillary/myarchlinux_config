"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[6743],{1645:(e,t,n)=>{n.r(t),n.d(t,{default:()=>oe});var r=n(7527),a=n(50122),u=n(89338),o=n(98093),s=n(2827),i=n.n(s),l=n(22155),c=n(14243),f=n(5947),d=n(30395),p=n.n(d),m=n(53823),b=n(83448),y=n(35234),g=n(17398),v=n(74502),h=n(75087),w=["signal"];function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.signal,u=(0,h.A)(n,w),o=new AbortController,s=fetch(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({signal:o.signal},u));r&&r.addEventListener("abort",(function(){return o.abort()}));var i=setTimeout((function(){return o.abort()}),t);return s.finally((function(){return clearTimeout(i)}))}var A,x,O,P=n(54883),F=n(91591),j=n(2972),N=(0,j.gql)(A||(A=(0,F.A)(["\n  query SourceByFeed($feed: String!) {\n    source: sourceByFeed(feed: $feed) {\n      id\n      name\n      image\n    }\n  }\n"]))),q=(0,j.gql)(x||(x=(0,F.A)(["\n  mutation RequestSource($data: RequestSourceInput!) {\n    requestSource(data: $data) {\n      id\n    }\n  }\n"]))),C=(0,j.gql)(O||(O=(0,F.A)(["\n  query SourceRequestAvailability {\n    sourceRequestAvailability {\n      hasAccess\n    }\n  }\n"]))),R=n(80244),D=n(28926),E=n(94198),T=n(16763),$=n(16714),I=n(57952),L=n(10665),B=n(77955),z=l.createElement,M=function(){return(0,B.k3)().isDrawer?z("img",{src:T.fu,alt:"A sample browser notification"}):null},_=function(){return(0,B.k3)().isDrawer?null:z("img",{className:"mx-auto my-14",src:T.fu,alt:"A sample browser notification"})};const H=function(e){var t=e.onRequestClose,n=(0,L.IR)({onPopupGranted:function(){return t(null)}}).onEnablePush,a=function(){var e=(0,u.A)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(I.vH.NewSourceModal);case 2:e.sent&&(null==t||t(null));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return z(E.aF,(0,r.A)({},e,{kind:E.aF.Kind.FlexibleTop,size:E.aF.Size.Medium,isDrawerOnMobile:!0,drawerProps:{className:{drawer:"pb-4",close:"mx-4"}}}),z(E.aF.Header,null),z(M,null),z(E.aF.Body,{className:"gap-2 px-4 pb-0 pt-3"},z(E.aF.Title,{className:"!typo-large-title tablet:typo-title1"},"Enable Push Notifications"),z(E.aF.Text,{className:p()("text-center typo-body tablet:typo-callout")},"Get notified of the status of your source submissions"),z(_,null)),z(m.$n,{variant:b.Ak.Primary,onClick:a,className:"m-4 mb-0 mt-5 flex tablet:hidden"},"Enable notifications"),z(E.aF.Footer,{justify:$.F1.Center},z(m.$n,{variant:b.Ak.Primary,onClick:a},"Enable notifications")))};var G=n(7848),U=n(75289),Y=n(8483),K=n(75240),X=n(26540),V=n(14431),Z=n(35393),J=n(58499),Q=n(43660),W=n(14647),ee=n(30530),te=n(38638),ne=n(36899),re=l.createElement;function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ue=function(e,t){return re("span",{className:"flex w-full flex-1 items-center justify-between"},e,re(m.$n,{variant:b.Ak.Tertiary,tag:"a",target:"_blank",href:t,icon:re(K.S,null)}))};function oe(e){var t,n,s=(0,l.useRef)(),d=(0,l.useState)(!1),h=d[0],w=d[1],S=(0,l.useState)(),A=S[0],x=S[1],O=(0,l.useState)(!1),F=O[0],j=O[1],T=(0,l.useState)(!1),$=T[0],I=T[1],B=(0,J.Gl)().isPushSupported,z=(0,L.IR)().hasPermissionCache,M=(0,l.useState)(),_=M[0],K=M[1],oe=(0,l.useState)(),se=oe[0],ie=oe[1],le=(0,l.useState)(),ce=le[0],fe=le[1],de=(0,l.useContext)(R.Ay),pe=de.user,me=de.isLoggedIn,be=de.loginState,ye=de.showLogin,ge=D._f.SubmitNewSource,ve=e.onRequestClose,he=(0,G.A)(Z.A,!1),we=(0,o.A)(he,2),Se=we[0],ke=we[1],Ae=(0,c.I)({queryKey:[ee.jZ.SourceRequestAvailability,null==pe?void 0:pe.id],queryFn:(t=(0,u.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne.e.request(C);case 2:return t=e.sent,e.abrupt("return",t.sourceRequestAvailability);case 4:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}),xe=Ae.data,Oe=Ae.isPending,Pe=function(){j(!0),x("Failed to fetch information, try to find the link to the RSS itself and try again.")},Fe=(0,f.n)({mutationFn:function(e){return ne.e.request(N,{feed:e})}}),je=Fe.mutateAsync,Ne=Fe.isPending,qe=(0,f.n)({mutationFn:(n=(0,u.A)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k("".concat(v.y0,"/scrape/source?url=").concat(t),2e4,{credentials:"same-origin"});case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),onMutate:function(){x(null),j(!1),K(null),ie(null),fe(null)},onSuccess:function(e){return"website"!==e.type?Pe():e.rss.length?K(e.rss.map((function(e){return{label:ue(e.title,e.url),value:e.url}}))):x("Could not find RSS feed")},onError:Pe}),Ce=qe.mutateAsync,Re=qe.isPending,De=(0,f.n)({mutationFn:function(e){return ne.e.request(q,{data:{sourceUrl:e}})},onSuccess:function(){z||!B||Se?null==ve||ve(null):I(!0)}}),Ee=De.mutateAsync,Te=De.isPending,$e=function(){var e=(0,u.A)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),pe){e.next=4;break}return ye({trigger:ge}),e.abrupt("return");case 4:return n=(0,g.Y)(t.currentTarget),e.next=7,Ce(n.url);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,u.A)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!ce){e.next=3;break}return e.abrupt("return");case 3:return n=(0,g.Y)(t.currentTarget),e.next=6,je(n.rss);case 6:if(!(r=e.sent).source){e.next=11;break}fe(r.source),e.next=13;break;case 11:return e.next=13,Ee(n.rss);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){var e=(0,u.A)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke(!0);case 2:ve(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({onRequestClose:Le},e);if(Oe)return null;var ze=me&&xe.hasAccess;if($)return re(H,Be);var Me=!(null==_||!_.length);return re(E.aF,(0,r.A)({},Be,{formProps:{title:"Suggest new source",form:Me?"select-feed":"submit-source",copy:{right:Me?"Submit for review":"Check link"},rightButtonProps:{disabled:Me?!se||!!ce:!h||!ze,loading:Me?Ne||Te:Re}}}),re(E.aF.Header,{title:"Suggest new source"}),re(E.aF.Body,null,re(E.aF.Text,null,"Have an idea for a new source? Insert its link below to add it to the feed."),re("a",{className:"mb-2 font-bold text-text-link underline typo-callout",target:"_blank",rel:"noopener",href:P.fX},"Content guidelines"),re("form",{className:"flex w-full flex-col",ref:s,onSubmit:$e,"aria-busy":Re,"data-testid":"login state: ".concat(null==be?void 0:be.trigger),id:"submit-source"},re(Q.A,{disabled:!ze||!(null==_||!_.length),className:{container:"mt-4"},inputId:"new-source-field",name:"url",label:"Paste blog / RSS URL",placeholder:"Paste blog / RSS URL",autoComplete:"off",type:"url",autoFocus:!0,"aria-describedby":A&&"new-source-field-desc",valueChanged:function(){s.current&&w(s.current.checkValidity())},fieldType:"primary",leftIcon:re(X.q,null),rightIcon:ze?void 0:re(V.X,{className:"text-text-disabled"})})),ze&&ce&&re(U.Ay,{className:"mt-4",type:U.vT.Error,title:re(l.Fragment,null,ce.name," already exist"," ",re(Y.A,{className:"ml-auto",source:ce,size:te.Ov.Small}))}),!ze&&re(W.e,{className:"mt-4"}),ze&&re(l.Fragment,null,!(null==_||!_.length)&&!ce&&re(l.Fragment,null,re("div",{className:"mb-6 self-start text-text-tertiary typo-callout"},_.length," RSS feed",_.length>1?"s":""," found"),re("form",{className:"flex w-full flex-col items-center",id:"select-feed",onSubmit:Ie},re(y.s,{name:"rss",options:_,onChange:ie,value:se,className:{container:"w-full self-start",content:"w-full pr-0"}}))),!ce&&A&&!(null!=_&&_.length)&&re(l.Fragment,null,re("div",{id:"new-source-field-desc",className:p()("self-start text-status-error typo-callout",!F&&"mb-6")},A),F&&re(m.$n,{tag:"a",className:"mb-6 mt-3 self-start",variant:b.Ak.Secondary,size:b.Mp.Small,href:"mailto:hi@daily.dev?subject=Failed to add new source",target:"_blank",rel:"noopener noreferrer"},"Contact")))),ze&&re(E.aF.Footer,null,!(null!=_&&_.length)&&re(m.$n,{form:"submit-source",variant:b.Ak.Primary,type:"submit",disabled:Re||!h,loading:Re},"Check link"),!(null==_||!_.length)&&re(l.Fragment,null,re(m.$n,{className:"mr-auto",disabled:Ne||Te,onClick:function(){K([])}},"Back"),re(m.$n,{form:"select-feed",variant:b.Ak.Primary,type:"submit",disabled:!se||!!ce,loading:Ne||Te},"Submit for review"))))}},8483:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(7527),a=n(75087),u=n(22155),o=n(27504),s=n(38638),i=n(55052),l=n(16763),c=n(91201),f=["source","rounded","isLink"],d=u.createElement;const p=function(e){var t=e.source,n=e.rounded,u=void 0===n?"full":n,p=e.isLink,m=(0,a.A)(e,f),b=(0,c.D)().isCompanion;return d(o.A,{condition:!!p,wrapper:function(e){return d(i.y,{href:t.permalink},e)}},d(s.Y3,(0,r.A)({},m,{rounded:u,user:{id:t.id,image:t.image,username:t.handle},fallbackSrc:l.N_,nativeLazyLoading:b})))}}}]);