"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[2408],{98474:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G});var o=n(7527),r=n(75087),i=n(22155),l=n(50122),u=n(30395),a=n.n(u),s=n(66007),c=n(24481),d=n(17398),m=(0,i.createContext)({mutateComment:null}),f=i.createElement;function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){var n,r=e.post,l=e.initialContent,u=e.replyTo,p=e.editCommentId,h=e.className,b=void 0===h?{}:h,y=e.style,g=e.onChange,C=e.showSubmit,w=void 0===C||C,O=e.showUserAvatar,j=void 0===O||O,x=e.formProps,P=void 0===x?{}:x,S=e.onClose,A=null==r?void 0:r.id,I=null==r||null===(n=r.source)||void 0===n?void 0:n.id,k=(0,i.useRef)(),N=(0,i.useContext)(m).mutateComment,D=N.mutateComment,T=N.isLoading,E=N.isSuccess;return(0,i.useEffect)((function(){var e;null==k||null===(e=k.current)||void 0===e||null===(e=e.textareaRef)||void 0===e||null===(e=e.current)||void 0===e||e.focus()}),[]),f("form",(0,o.A)({},P,{action:"#",onSubmit:function(e){if(e.preventDefault(),T||E)return null;var t=(0,d.Y)(e.currentTarget).content;return D(t)},className:null==b?void 0:b.container,style:y,ref:t}),f(c.A,{ref:k,className:{tab:a()("!min-h-16",null==b?void 0:b.tab),input:a()(null==b?void 0:b.input,u&&"mt-0"),profile:u&&"!mt-0",container:null==b?void 0:b.markdownContainer},postId:A,sourceId:I,showUserAvatar:j,isLoading:T,disabledSubmit:E,initialContent:l,textareaProps:{name:"content",rows:7,placeholder:"Share your thoughts"},onSubmit:function(e){if(T||E)return null;var t=e.currentTarget.value;return D(t)},enabledCommand:v(v({},s.RS),{},{upload:!0}),submitCopy:w&&(p?"Update":"Comment"),timeline:u?f("span",{className:"py-2 pl-12 text-text-tertiary typo-caption1"},"Reply to",f("span",{className:"ml-2 font-bold text-text-primary"},u)):null,onValueUpdate:g,onClose:S}))}var b=(0,i.forwardRef)(h),y=n(72870),g=n(89338),C=n(2827),w=n.n(C),O=n(69918),j=n(94198),x=n(15751),P=n(92203),S=n(5947),A=n(99604),I=n(57952),k=n(11924),N=n(30530),D=n(51722),T=n(61663),E=n(91201),R=n(80244);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=function(e){var t,n=e.post,o=e.editCommentId,r=e.parentCommentId,l=e.onCommented,u=null==n||null===(t=n.source)||void 0===t?void 0:t.id,a=null==n?void 0:n.id,s=null!=r?r:a,c=(0,R.Z2)().user,d=(0,O.jE)(),m=(0,E.D)(),f=m.requestMethod,p=m.isCompanion,v=(0,T.DX)().logEvent,h=(0,i.useMemo)((function(){return N.$h.apply(void 0,[N.jZ.PostCommentsMutations,c].concat((0,P.A)([a,u,o,r].filter((function(e){return!!e})))))}),[c,a,u,o,r]),b=function(e){if(e){var t=function(t){if(!t)return t;var n=structuredClone(t);if(!o){var i=function(e){return{node:F(F({},e),{},{children:{edges:[],pageInfo:null}})}}(e);if(!r)return n.postComments.edges.unshift(i),n;var l=n.postComments.edges.findIndex((function(e){return e.node.id===r}));return n.postComments.edges[l].node.children.edges.push(i),n}if(!r){var u=n.postComments.edges.findIndex((function(e){return e.node.id===o}));return n.postComments.edges[u].node=F(F({},e),{},{children:n.postComments.edges[u].node.children}),n}var a=n.postComments.edges.find((function(e){return e.node.id===r})),s=a.node.children.edges.findIndex((function(e){return e.node.id===o}));return a.node.children.edges[s].node=F(F({},e),{},{children:a.node.children}),n},i=[];(0,N.w$)(a).forEach((function(e){d.setQueryData(e,(function(n){return n?t(n):(i.push(e),null)}))})),i.forEach(function(){var e=(0,g.A)(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.invalidateQueries({queryKey:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o||((0,N.kh)(d,a,{numComments:n.numComments+1}),v((0,k.P5)(I.VB.CommentPost,n,{extra:{commentId:r}}))),l&&l(e,!o,r)}},y=r?A.Uk:A.Fe,C=(0,S.n)({mutationFn:function(e){return f(y,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),j=C.mutateAsync,x=C.isPending,M=C.isSuccess;(0,D.X)(h,{enabled:p,callback:function(e){var t=e.res;return b(null==t?void 0:t.comment)}});var K=(0,S.n)({mutationFn:function(e){return f(A.fK,e,{requestKey:JSON.stringify(h)})},onSuccess:function(e){return b(null==e?void 0:e.comment)}}),q=K.mutateAsync,L=K.isPending;return{mutateComment:(0,i.useCallback)((function(e){return o?q({id:o,content:e}):j({content:e,id:s})}),[o,s,q,j]),isLoading:x||L,isSuccess:M}},q=n(4004),L=function(){var e,t,n,o;return{width:null!==(e=null===globalThis||void 0===globalThis||null===(t=globalThis.window)||void 0===t||null===(t=t.visualViewport)||void 0===t?void 0:t.width)&&void 0!==e?e:0,height:null!==(n=null===globalThis||void 0===globalThis||null===(o=globalThis.window)||void 0===o||null===(o=o.visualViewport)||void 0===o?void 0:o.height)&&void 0!==n?n:0}},U=function(){var e,t=(0,i.useState)(L),n=t[0],o=t[1];return(0,q.M)(null===globalThis||void 0===globalThis||null===(e=globalThis.window)||void 0===e?void 0:e.visualViewport,"resize",(function(){return o(L)})),n},V=n(57434),z=n(68334),H=n(91480),Q=n(86242),$=i.createElement;function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,i=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw i}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var J=function(e,t){var n,o;if(null!=e&&null!==(n=e.postComments)&&void 0!==n&&n.edges){var r,i=_(null==e||null===(o=e.postComments)||void 0===o?void 0:o.edges);try{for(i.s();!(r=i.n()).done;){var l=r.value;if(l.node.id===t)return l.node;if(l.node.children){var u,a=_(l.node.children.edges);try{for(a.s();!(u=a.n()).done;){var s=u.value;if(s.node.id===t)return s.node}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){i.e(e)}finally{i.f()}}},Z=function(e){var t=e.client,n=e.postId,o=e.commentId;if(o){var r,i=_((0,N.w$)(n));try{for(i.s();!(r=i.n()).done;){var l=r.value,u=J(t.getQueryData(l),o);if(u)return u}}catch(e){i.e(e)}finally{i.f()}}};function X(e){var t,n,o,r,l,u,s,c,d,f,p=e.isOpen,v=e.onRequestClose,h=e.onAfterClose,y=e.onCommented,C=e.parentCommentId,P=e.replyToCommentId,S=e.editCommentId,A=e.post,k=(0,i.useRef)(null),N=(0,i.useRef)(null),D=(0,i.useRef)(null),T=(0,i.useRef)(null),E=(0,R.Z2)().user,M=(0,O.jE)(),F=(0,i.useState)(null),q=F[0],L=F[1],_=!!S,B=!_&&!!P,J=(0,Q.A)({id:S,options:{enabled:!!S}}).comment,X=(0,i.useCallback)((function(e){e&&L(e)}),[L]),Y=(0,V.$)({source:I.vH.NewComment}),W=Y.shouldShowCta,G=Y.isEnabled,ee=Y.onToggle,te=Y.onSubmitted,ne=(0,i.useMemo)((function(){return Z({client:M,postId:null==A?void 0:A.id,commentId:_?S:null!=P?P:C})}),[M,null==A?void 0:A.id,_,S,C,P]),oe=K({post:A,editCommentId:_&&S,parentCommentId:C,onCommented:function(e,t,n){y&&y(e,t,n),v()}}),re=oe.isLoading,ie=oe.isSuccess;(0,i.useLayoutEffect)((function(){var e;null==q||null===(e=q.scrollTo)||void 0===e||e.call(q,{behavior:"auto",top:1e4})}),[q]);var le=U().height,ue=null!==(t=null===(n=D.current)||void 0===n?void 0:n.clientHeight)&&void 0!==t?t:0,ae=null!==(o=null===(r=T.current)||void 0===r?void 0:r.clientHeight)&&void 0!==o?o:0,se=le-(null!==(l=null===(u=N.current)||void 0===u?void 0:u.offsetHeight)&&void 0!==l?l:0)-ue-ae,ce=se>0?Math.max(se,300):"auto";k.current&&(null===(s=k.current.style)||void 0===s?void 0:s.height)!=="".concat(ce,"px")&&(k.current.style.height="".concat(ce,"px"));var de,me=(0,i.useMemo)((function(){return _?{submitCopy:"Save",initialContent:null==J?void 0:J.content}:B?{submitCopy:"Reply",initialContent:null!=ne&&null!==(e=ne.author)&&void 0!==e&&e.id&&ne.author.id!==(null==E?void 0:E.id)?"@".concat(null==ne||null===(t=ne.author)||void 0===t?void 0:t.username," "):void 0}:{submitCopy:"Comment"};var e,t}),[_,B,ne,J,null==E?void 0:E.id]),fe=me.submitCopy,pe=me.initialContent;return $(j.aF,{isOpen:p,onRequestClose:v,onAfterClose:h,className:"!border-none",overlayClassName:"!touch-none"},$(j.aF.Body,{className:"!p-0",ref:X},$(m.Provider,{value:{mutateComment:oe}},$(x._,{form:"write-comment",copy:{right:fe},leftButtonProps:{onClick:v},rightButtonProps:{onClick:(de=(0,g.A)(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:case"end":return e.stop()}}),e)}))),function(){return de.apply(this,arguments)}),loading:re,disabled:ie},className:{container:"flex-1 first:!border-none",header:"sticky top-0 z-2 w-full bg-background-default"},headerRef:N},B&&ne&&$(i.Fragment,null,$(H.A,{post:A,comment:ne,className:{container:"mx-4 mt-4 border"},postAuthorId:null==A||null===(c=A.author)||void 0===c?void 0:c.id,postScoutId:null==A||null===(d=A.scout)||void 0===d?void 0:d.id}),$("div",{className:"ml-12 flex gap-2 border-l border-border-subtlest-tertiary py-3 pl-5 text-text-tertiary typo-caption1",ref:D},"Reply to",$("span",{className:"font-bold text-text-primary"},null===(f=ne.author)||void 0===f?void 0:f.username))),$(b,{ref:k,replyTo:null,post:A,parentCommentId:C,editCommentId:_&&S,initialContent:pe,className:{markdownContainer:"flex-1",container:a()("flex flex-col",B?"h-[calc(100%-2.5rem)]":"h-full"),tab:"flex-1",input:"comment-input-123 !max-h-none flex-1"},showSubmit:!1,showUserAvatar:!1,formProps:{id:"write-comment"}}),W&&$(z.d,{inputId:"push_notification-switch",name:"push_notification",labelClassName:"flex-1 font-normal",className:"px-3 py-3.5",compact:!1,checked:G,onToggle:ee,ref:T},"Receive updates when other members engage")))))}var Y=["onClose","className"],W=i.createElement;function G(e){var t=e.onClose,n=e.className,i=(0,r.A)(e,Y),l=!(0,y.G6)(y.bh.Tablet),u=K({post:i.post,editCommentId:i.editCommentId,parentCommentId:i.parentCommentId,onCommented:i.onCommented});return l?W(X,(0,o.A)({},i,{isOpen:!0,onRequestClose:t})):W(m.Provider,{value:{mutateComment:u}},W(b,(0,o.A)({},i,{className:n.input,onClose:t})))}},68334:(e,t,n)=>{n.d(t,{d:()=>v});var o=n(7527),r=n(75087),i=n(22155),l=n(30395),u=n.n(l);const a="_5r2X27zKbL3K-0KuztabLA==",s="_9VJTarzDvJAPMOKQbzHeEQ==",c="+hRUmPa5hVn8ncwI9jw3WQ==",d="D5NR++a7+cgnxCM1YywMSg==";var m=["className","labelClassName","inputId","name","checked","children","onToggle","compact","defaultTypo","disabled"],f=i.createElement;function p(e,t){var n=e.className,i=e.labelClassName,l=e.inputId,p=e.name,v=e.checked,h=e.children,b=e.onToggle,y=e.compact,g=void 0===y||y,C=e.defaultTypo,w=void 0===C||C,O=e.disabled,j=(0,r.A)(e,m);return f("label",{className:u()(n,"group relative flex items-center",O?"pointer-events-none cursor-not-allowed opacity-32":"cursor-pointer",c),htmlFor:l,ref:t},f("input",(0,o.A)({},j,{disabled:O,id:l,name:p,type:"checkbox",checked:v,onChange:b,className:"absolute h-0 w-0 opacity-0"})),f("span",{className:u()("relative block",g?"h-4 w-8":"h-5 w-10")},f("span",{className:u()("absolute bottom-0 left-0 top-0 my-auto w-full bg-theme-overlay-quaternary",g?"h-2.5 rounded-3":"h-3 rounded-4",a)}),f("span",{className:u()("absolute left-0 top-0 bg-text-tertiary",g?"h-4 w-4 rounded-3":"h-5 w-5 rounded-6",s)})),h&&f("span",{className:u()("ml-3 font-bold text-text-tertiary",w&&"typo-footnote",d,i)},h))}var v=i.forwardRef(p)},57434:(e,t,n)=>{n.d(t,{$:()=>s});var o=n(89338),r=n(2827),i=n.n(r),l=n(22155),u=n(57952),a=n(35393),s=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).source,t=void 0===e?u.vH.SquadPostCommentary:e,n=(0,l.useState)(!0),r=n[0],s=n[1],c=(0,a.W)({source:t}),d=c.shouldShowCta,m=c.onEnable,f=c.onDismiss,p=function(){var e=(0,o.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return");case 2:return t=r?m:f,e.next=5,t();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=(0,l.useCallback)((function(){return s((function(e){return!e}))}),[]);return{isEnabled:r,onToggle:v,shouldShowCta:d,onSubmitted:p}}},17398:(e,t,n)=>{n.d(t,{Y:()=>l});var o=n(50122);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){return Array.from(e.elements).reduce((function(e,t){return""===t.name?e:"checkbox"===t.type?i(i({},e),{},(0,o.A)({},t.name,t.checked)):"radio"!==t.type||t.checked?"file"===t.type?i(i({},e),{},(0,o.A)({},t.name,0===t.files.length?null:t.files)):i(i({},e),{},(0,o.A)({},t.name,t.value.length?t.value:null)):e}),t)}},73855:(e,t,n)=>{n.d(t,{PK:()=>l,rZ:()=>a,vv:()=>u});var o=n(50122),r=n(81602);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var l=function(e){return"string"==typeof e&&"true"===e.toLowerCase()},u=function(e,t){return"number"!=typeof e?"":e.toLocaleString(["en-US"],function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({minimumFractionDigits:2,maximumFractionDigits:2},t))},a=function(e){return e>1e5?(0,r.Kt)(e):u(e,{minimumFractionDigits:0})}}}]);